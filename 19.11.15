<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
        <meta name="mobile-web-app-capable" content="yes">
		<title>Cerberus Web Client</title>
				
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="icon" sizes="196x196" href="/images/android-icon-196x196.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png" /> 
               
		<!-- Bootstrap core CSS -->
		<link rel="stylesheet" href="/css/bootstrap.min.css" />
		<link rel="stylesheet" href="/css/bootstrap-datetimepicker.min.css" />
		
		<link rel="stylesheet" href="/custom/css/default-theme.css" />
        
		<link rel="stylesheet" href="/css/common-3.0.css" />
		<link rel="stylesheet" href="/css/jquery.dataTables.css" />
        <link rel="stylesheet" href="/css/dataTables.bootstrap.css" />
		<link rel="stylesheet" href="/css/colorbox-1.0.css" />
		<link rel="stylesheet" href="/css/bootstrap-tokenfield-1.0.css" />
		
		<link rel="stylesheet" href="/css/login-3.0.css" />

		<!--[if gte IE 9]>
			<style type="text/css">
				.gradient { filter: none; }
			</style>
		<![endif]-->

		<!--[if lte IE 9]>
			<link rel="stylesheet" href="/css/common-3.0-ie8.css" />
		<![endif]-->	

		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
			<script src="/js/html5shiv.min.js"></script>
			<script src="/js/respond.min.js"></script>
		<![endif]-->	
	
		<script src="/js/jquery-1.11.2.min.js"></script> 
		<script src="/js/bootstrap.min.js"></script> 
		<script src="/js/functions-3.0.js"></script>
		
		<!-- The combined tables, lightbox, block, timeago, tag, timepicker, history -->
		<script src="/js/jquery.filebrowser.plugin-2.4.js"></script>
        
		
		<!-- Javascript language file -->
		<script src="/js/lang-1/en-us.js"></script> 
		
	</head> 
	<body>
   
    <!-- Wrap all page content here -->
	<div id="wrap">
    
		<!-- Fixed navbar -->
		<div class="navbar navbar-default navbar-static-top">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/"><img class="hidden-xs" src="/images/logo/logo1.png" width="230" height="70" alt="logo"><span class="visible-xs-inline">Cerberus</span></a>
              </div>
              <div class="collapse navbar-collapse">
				<div class="navbar-nav navbar-right">
                    <div class="navbar-text navbar-right" style="margin: 10px 10px 10px 5px">
                            <small>Not currently logged in
                            </small>
                    </div>
                    <div class="clearfix"></div>
                    <ul class="nav nav-tabs navbar-right" style="border-bottom: none">
                        <li class="nav_home_item active"><a href="/">Home</a></li>
                        <li class=""><a href="/account?action=display">Account</a></li>
                        
                    </ul>
                    <div class="clearfix"></div>
                </div>
				<div class="clearfix"></div>
              </div><!--/.nav-collapse -->
            </div>
		</div>

        
        <div class="page-header">
            <div class="container-fluid">
                <h1 class="page-title"><span class="glyphicon glyphicon-globe"></span>&nbsp;&nbsp;Public</h1>
            </div>
        </div>
        
		<!-- Begin page content -->
		<div class="container-fluid">
            <div id="status-container">
                
                
                
                
            </div>
	
	
			
	
	
	
	
	<script type="text/javascript">
		//<![CDATA[	
		var curDir = "/";
		var curDirParam = "/";
		//]]>
	</script>
	
	<ol id="breadcrumb2" class="navbar-form breadcrumb">
	  <li><a href="/public/folder/TEbvD5Gi-EuyNMWtEmXVjw/root/"><img src="/images/home.png" alt="root" width="16" height="16" title="root" /></a></li>
	  
	</ol>
	
	<form id="public-op-form" name="public-op-form" action="/public/folder/TEbvD5Gi-EuyNMWtEmXVjw/root" method="post">
	
		<input type="hidden" id="cd" name="cd" value="/" >
		<input type="hidden" id="file_id" name="file_id" value="TEbvD5Gi-EuyNMWtEmXVjw" >
	
	    <div id="toolbar" class="panel panel-default">
	    	<div class="panel-body">
	            <div class="btn-toolbar">
	                <div class="btn-group pull-left">
	                    <button type="button" class="btn btn-sm btn-default navbar-btn" id="refresh-btn" data-placement="top" data-content="Retrieve the current directory listing again from the server" title="Retrieve directory listing"><span class="glyphicon glyphicon-refresh"></span></button>
	                    
	                    <button type="button" class="btn btn-sm btn-default navbar-btn" id="thumb-btn" data-placement="bottom" title="Thumbnails" data-content="Show thumbnails for images"><span class="glyphicon glyphicon-picture"></span></button>
	                                    
	                    <button type="button" class="btn btn-sm btn-default navbar-btn" id="select-all-btn" value="Check All"><span class="glyphicon glyphicon-check"></span><span class="t"> Check&nbsp;All</span></button>
	                </div>
	                <div class="btn-group pull-right">
	                    <button type="button" class="btn btn-sm btn-default navbar-btn" id="zip-btn" data-placement="top" title="Zip" data-content="Compress the selected files and directories into a single file and download it"><span class="glyphicon glyphicon-compressed"></span><span class="t"> Zip and Download</span></button>
	                </div>
	                <div class="clearfix"></div>
	            </div>
			</div>
	    </div>
	
	    
	    <table id="publicFileList" class="displayPublic table table-bordered table-striped">
	        <thead> 
	            <tr>
	              <th>Name</th>
	              <th class="ty">Type</th>
	              <th class="sz">Size</th>
	              <th class="dt">Date </th>
	            </tr>
	        </thead> 
	        <tfoot> 
	            <tr>
	              <th>Name</th>
	              <th class="ty">Type</th>
	              <th class="sz">Size</th>
	              <th class="dt">Date</th>
	            </tr>
	        </tfoot>			
	        <tbody> 
	
	        </tbody>  
	    </table>
		<div class="clr"></div>
	</form>	
	
	
	
	<!-- The Zip confirmation dialog -->
	<div class="modal fade" id="dialog-zip-confirm" tabindex="-1" role="dialog" aria-hidden="true" aria-labelledby="zipDialogLabel">
	    <div class="modal-dialog">
	      <div class="modal-content">
	        <div class="modal-header">
	          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	          <h4 class="modal-title" id="zipDialogLabel">Zip and download the selected items?</h4>
	        </div>
	        <div class="modal-body">
	            <p class="help-block"><span class="glyphicon glyphicon-question-sign"></span>
	            Are you sure you want to create a zip file with the selected items?</p>
	
				<div class="form-group">
					<label class="control-label" for="zipname">Zip Filename:</label>
					<input class="form-control" type="text" id="zipname" name="zipname" value="archive.zip" />
				</div>
	
	        </div>
	        <div class="modal-footer">
	          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
	          <button type="button" id="dlg-zip-confirm-btn" class="btn btn-primary"><span class="glyphicon glyphicon-compressed"></span> Zip</button>
	        </div>
	      </div><!-- /.modal-content -->
	    </div><!-- /.modal-dialog -->
	</div><!-- /.modal -->
	
	
	<script type="text/javascript">
		//<![CDATA[	
	var oTable;
	var aSelected = [];
	
	var cftp = {
		thumbnails: false
	};
	
	
	function getBreadcrumb( formdata )
	{
		$.ajax({
			url: '/public/folder/TEbvD5Gi-EuyNMWtEmXVjw/get_bc',
			dataType: 'json', 
			type: 'POST',
			data: formdata
		})
		.done(function( data ) {
		
			$('#breadcrumb2').html(data.content);
			$('#cd').val(data.cd);
			
			curDir = data.cd;
			curDirParam = data.cdUri;
			
			aSelected.length=0;
			
			/* 
			 * Clear the global filter			          
			 * and Redraw the table	 
			 */		          
			oTable.api().search("").draw();
	
			$("#publicFileList_filter").children("input[type='search']:first").val("");
		})
		.fail(function( jqxhr, textStatus, error ) {
		
			handleJsonFail(jqxhr, textStatus, error);
		});	
	}
	
	function handleJsonFail(jqxhr, textStatus, error) {
		
		resetStatus();
		if( jqxhr.status == 200 ) {
			addStatusMsg(false, cftp_msg.timeout);
		}
		else {
			addStatusMsg(false, cftp_msg.comm_failure);
		}
	}
	
	/* Function to create the Zip confirmation dialog */
	function createDialogZipConfirm(zipButton, cancelButton, locale) {
	
		var btns = {};
		var dialog = $("#dialog-zip-confirm");
		
		/* Create Directory dialog */
		var zipNameField = $( "#zipname", dialog );
		var allFields = $( [] ).add(zipNameField);
	
		// The Zip button
		$("#dlg-zip-confirm-btn").click(function(e) {
			
			if( zipNameField.val() === "" ) {
	
				updateTips( locale.validate_zip_filename, $( ".validateTips", this ) )
				zipNameField.parent().addClass("has-error").focus();
			}
			else {
				
				var zipMsg = "Your zip file is being prepared and will start downloading when ready";
				
				resetStatus();
				addStatusMsg(true, zipMsg);
				
				dialog.modal('hide');
				//$.blockUI({ message: zipMsg }); 
				
				
				var currentDir = $('#cd').val();
				var zipFilename = zipNameField.val();
				// Simple error checking to prevent some invalid file names
				zipFilename = zipFilename.replace(/[/\\*?]/g, "_");
				
				// Dynamnically create a form
				var frm = $("<form>");
				frm.attr({'action':'/public/folder/TEbvD5Gi-EuyNMWtEmXVjw/zip/' + encodeURIComponent(zipFilename), 'method': 'post'});
				$('<input>').attr({ type: 'hidden', name: 'cd', value: $('#cd').val() }).appendTo(frm);
				$('<input>').attr({ type: 'text', name: 'zipname', value: zipFilename }).appendTo(frm);
				$('<input>').attr({ type: 'hidden', name: 'csrftoken', value: $('#csrftoken').val() }).appendTo(frm);
				$.each(aSelected, function(i, val) {
					$('<input>').attr({ type: 'hidden', name: 'ID', value: val }).appendTo(frm);
				});
				
				// Append the new form to the body
				frm.appendTo($('body'));
				// Submit the new form
				frm.submit();
	
				//$.unblockUI();
			}
		});
		
		dialog.on('show.bs.modal', function () {
			
			// Clear out the fields
			allFields.parent().removeClass("has-error");
			
			if( aSelected.length == 1 ) {
				var zipname = aSelected[0];
				zipNameField.val(zipname + ".zip");
			}
			else {
				zipNameField.val("archive.zip");
			}
		});
	}
	
	
	$(document).ready(function() {
			
		oTable = $('#publicFileList').dataTable( {
			"sDom": "<'panel panel-default no-btn-margin'<'panel-body'<'row'<'col-sm-6 col-xs-9'f><'col-sm-6 col-xs-3'<'pull-right'l><'clearfix'>>>r>>t<'row'<'col-sm-6'i><'col-sm-6'p>>",
			"oLanguage": {
				"sLengthMenu": "<div class='hidden-inline-xs'>Show&nbsp;</div> _MENU_",
				"sSearch": "",
				"sSearchPlaceholder": "Filter"
				},
			"bAutoWidth": false,
			"sPaginationType": "simple_numbers",
			"bProcessing": true,
	        "bServerSide": true,
	        "iDisplayLength": 10,
			"aLengthMenu" : [ 10, 25, 50, 100, 250 ],
			"aaSorting": [],
	        "sAjaxSource": "/public/folder/TEbvD5Gi-EuyNMWtEmXVjw/get_dir",
	        "sServerMethod": "POST",
	        "fnServerParams": function ( aoData ) {
	 		     aoData.push( { "name": "cd", "value": $('#cd').val() } );
				 var deepSearch = $("#publicFileList_searchCheck").is(":checked");
				 if( deepSearch ){
	 		     	aoData.push( { "name": "deepSearch", "value": deepSearch } );
				 }
	 	   	},
	        "fnServerData": function ( sSource, aoData, fnCallback ) {
					$.post( sSource, aoData, function (json) { 
						/* Do whatever additional processing you want on the callback, then tell DataTables */
						fnCallback(json)
					},
					"json")
					.fail(function( jqxhr, textStatus, error ) {
					
						handleJsonFail(jqxhr, textStatus, error);
					});
		        },
			"aoColumns": [ 
			      { "mData": "fname",
					"mRender": function ( data, type, full ) {
				      		
			      		var hrefval;
			      		var htmlImg = '';
			      		var aClass = '';
						
						var fileType = full["type"];
						var fileDisplay = full["name"];
						var fileValue = full["value"];
						var fileSize = full["size"];
						
						var xsExtraInfo = '';
			      		if( fileType == 'file' ) {
	
							aClass = 'file';
			      			hrefval = '/public/folder/TEbvD5Gi-EuyNMWtEmXVjw/dl/'+ data + '?cd=' + curDirParam + '&amp;p=' + data;
							xsExtraInfo = '<div class="visible-xs"><div class="pull-left">' + jQuery.timeago(full["time"]) + '</div><div class="pull-right badge">' + size_format(full["size"]) + '</div><div class="clearfix"></div></div>';
			      		}
			      		else if( fileType == 'up' ) {
							aClass = 'up';
			      			hrefval = '/public/folder/TEbvD5Gi-EuyNMWtEmXVjw/root/path?op=cdup&cd=' + curDirParam;
			      		}
			      		else {
							aClass = 'fd';
			      			hrefval = '/public/folder/TEbvD5Gi-EuyNMWtEmXVjw/root/path?op=cwd&cd=' + curDirParam + '&amp;p=' + data;
							xsExtraInfo = '<div class="visible-xs">' + jQuery.timeago(full["time"])  + '</div>';
			      		}
						
						// Construct the IMG and A tags
						if( cftp.thumbnails && (fileSize < 6000000) && fileValue.match(/.+\.(png|gif|jpe?g)$/i) ) {
					      	aClass = "thumbnail";
							htmlInnerA = '<img src="' + hrefval + '&amp;m=1" alt="'+ fileValue + '"  height="100" width="200" />&nbsp;&nbsp;' + fileDisplay;
						}
						else {
				      		htmlInnerA = fileDisplay;
							htmlImg = '<img src="/images/icons/' + full["icon"] + '" alt="'+ fileValue + '" height="20" width="20" />&nbsp;';
						}
			      		
						htmlA = '<a class="' + aClass + '" href="' + hrefval + '" alt="' + fileValue + '" title="' + fileValue + '">'+ htmlInnerA + '</a>';
			        	
						// Construct the IMG and A tags
						htmlReturn = (htmlImg  + '&nbsp' + htmlA + xsExtraInfo);
						
			        	return htmlReturn;
				     }
			      },
			      { "mData": "type", 
				  	"sClass": "hidden-xs",
				  	"bSortable": false 
				  },
			      { "mData": "size",
				  	"sClass": "right hidden-xs",
					"mRender": function ( data, type, full ) {
			        	return (full["type"] == 'file' ? ('<span title="' + data + ' bytes">' + size_format(data) + '</span>') : '');
				     }
				  },
			      { "mData": "ftime",
				  	"sClass": (cftp.relativeDates ? "right hidden-xs" : "center hidden-xs"),
					"mRender": function ( data, type, full ) {
			        	return (full["type"] == 'up' ? '' : ('<time datetime="' + full["time"] + '">'  + (cftp.relativeDates ? jQuery.timeago(full["time"]) : data) + '</time>'));
				     }
				  } 
			],
			"fnRowCallback": function( nRow, aData, iDisplayIndex ) {
	            if ( jQuery.inArray(aData.DT_RowId, aSelected) !== -1 ) {
	
	                $(nRow).addClass('selected').find("input[name=ID]").prop("checked", true);
	            }
		     }
			
		} );
	
		/* This allows the back button to actually navigate back for our ajax calls */
		$(window).on("popstate", function(e) {
			// receiving location from the window.history object
			var loc = history.location || document.location;
			window.location = loc;
		});
	
		
		$("#publicFileList_searchCheck").click(function() {
	    
	    	/* Redraw the table */
			oTable.api().draw();
		});	
	
				
		/* Add a click handler for changing directories */
		$('#publicFileList tbody').on("click", "a.fd", function (e) {
			
			e.preventDefault();
			
			var formdata = $.param([{ name: "cd", value: $('#cd').val() },
									{ name: "dir", value: $(this).attr("title") }]);
	
			getBreadcrumb(formdata);
			
			/* Update the History */			          
			history.pushState(null, document.title, $(this).prop('href'));
	    } );
	  
		/* Add a click handler for the directory up link */
		$('#publicFileList tbody').on("click", "a.up", function(e) {
			
			e.preventDefault();
			
			var formdata = $.param([{ name: "cd", value: $('#cd').val() },
									{ name: "dir", value: '..' }]);
	
			getBreadcrumb(formdata);
			
			/* Update the History */			          
			history.pushState(null, document.title, $(this).prop('href'));
	    } );
		     	
		/* Add a click handler to the rows */
		$('#publicFileList tbody').on("click", "tr", function() {
	
	        var id = this.id;
	        var index = jQuery.inArray(id, aSelected);
	         
	        if ( index === -1 ) {
	            aSelected.push( id );
	        } else {
	            aSelected.splice( index, 1 );
	        }
			
			if ( $(this).hasClass('selected') ) {
				
				$(this).find("input[name=ID]").prop("checked", false);
			}
			else {
				
				$(this).find("input[name=ID]").prop("checked", true);
			}
	
			$(this).toggleClass('selected');
		} );
	
	
	    // unblock when ajax activity stops 
	    $(document).ajaxStop($.unblockUI); 
	
		$.blockUI.defaults.css.border = '1px solid #CCC'; 
		$.blockUI.defaults.fadeIn = 100;
		$.blockUI.defaults.fadeOut = 200;
	
		
		/* Initialize the Refresh button */
		$( "#refresh-btn" ).button(cftp_msg.refresh_label).click(function() {
	    
			/* Unhighlight the row and unselect the checkboxes */
			aSelected.length = 0;
			
	    	/* Redraw the table */
			oTable.api().draw();
			
			resetStatus();
			addStatusMsg(true, "Current directory refreshed");
		});
		
		/* Initialize the Thumbnails button */
		$( "#thumb-btn" ).button().click(function() {
	    
			cftp.thumbnails = !cftp.thumbnails;
			if( cftp.thumbnails ) {
				$( "#thumb-btn" ).removeClass("btn-default").addClass("btn-info");
			}
			else {
				$( "#thumb-btn" ).removeClass("btn-info").addClass("btn-default");
			}
			
	    	/* Redraw the table */
			oTable.api().draw();
		});	
			
		/* Create the Zip confirmation dialog */
		createDialogZipConfirm(cftp_msg.zip_btn, cftp_msg.cancel_btn, cftp_msg);
	
		/* Initialize the Zip button */
		$("#zip-btn").button(cftp_msg.zip_label)
			.click(function() {
		
				clearStatus();
				if( aSelected.length <= 0 ) {
					
					resetStatus();
					addWarningMsg("You have not selected any files to zip");
				}
				else {
					
					$("#dialog-zip-confirm").modal('show');
				}
		});	
		
		/* Select All Button */
		$( "#select-all-btn" ).button(cftp_msg.select_label).click(function() {
	
			// Unhighlight the row and unselect the checkboxes
			aSelected.length = 0;
			
			var iconHtml = '<span class="glyphicon glyphicon-check"></span> ';
			var checkState = true;
			if( $(this).prop('value') == cftp_msg.unselect_label) {
					
				checkState = false;
				$(this).prop('value', cftp_msg.select_label)
			 	$( "#select-all-btn" ).html(iconHtml + '<span class="t"> '+ cftp_msg.select_label+'</span>');
			}
			else {
			
				$(this).prop('value', cftp_msg.unselect_label)
				iconHtml = '<span class="glyphicon glyphicon-unchecked"></span> ';
			 	$( "#select-all-btn" ).html(iconHtml + '<span class="t"> '+ cftp_msg.unselect_label+'</span>');
			}
			
			if( checkState ) {
				var aTrs = oTable.fnGetNodes();
				for ( var i=0 ; i<aTrs.length ; i++ ) {
					if( aTrs[i].id != '' ){
						aSelected.push( aTrs[i].id );
					}
				}
			}
		
			/* Redraw the table */
			oTable.api().draw();
		});
			
	});
	
	//]]>
	</script>
	
	
			
		

		</div>
	</div>

	<div id="footer">
		<div class="container-fluid">
			<p class="text-muted credit">
				<a href="/">Home</a>
				&nbsp;<span class="sep_footer_nav">|</span><a href="/account?action=display">Account</a>
				
                &nbsp;<span class="sep_footer_nav">|</span><a href="#" id="_context_help_"><span class="glyphicon glyphicon-question-sign"></span> Help</a>
			</p>
		</div>
	</div>

	</body>
</html>